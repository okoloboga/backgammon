<!DOCTYPE html>
<html>
<head>
    <title>Jetton Balance Test</title>
</head>
<body>
    <h1>Jetton Balance Test</h1>
    <div id="result"></div>
    
    <script>
        const RUBLE_JETTON_MASTER = 'EQA5QopV0455mb09Nz6iPL3JsX_guIGf77a6l-DtqSQh0aE-';
        const TEST_ADDRESS = 'UQCZKiq-ubTdwsm66E1WvN7nc9YObaL7pTjCM1ULZ6pPF_8t';
        
        async function testJettonBalance() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Testing...';
            
            try {
                const response = await fetch(`https://toncenter.com/api/v3/jetton/wallets?owner_address=${TEST_ADDRESS}&jetton_address=${RUBLE_JETTON_MASTER}`);
                
                if (!response.ok) {
                    resultDiv.innerHTML = `❌ API Error: ${response.status}`;
                    return;
                }

                const data = await response.json();
                
                if (!data.jetton_wallets || data.jetton_wallets.length === 0) {
                    resultDiv.innerHTML = '❌ No jetton wallets found';
                    return;
                }

                // Находим нужный jetton wallet
                const jettonWallet = data.jetton_wallets.find(wallet => {
                    if (wallet.jetton === RUBLE_JETTON_MASTER) return true;
                    
                    for (const [rawAddress, addressInfo] of Object.entries(data.address_book)) {
                        if (addressInfo.user_friendly === RUBLE_JETTON_MASTER && wallet.jetton === rawAddress) {
                            return true;
                        }
                    }
                    return false;
                });

                if (!jettonWallet) {
                    resultDiv.innerHTML = '❌ No matching jetton wallet found';
                    return;
                }
                
                const balanceNumber = parseInt(jettonWallet.balance, 10);
                const convertedBalance = balanceNumber / 1000000000;
                
                resultDiv.innerHTML = `
                    ✅ Success!<br>
                    Raw balance: ${jettonWallet.balance}<br>
                    Converted balance: ${convertedBalance.toFixed(9)} RUBLE<br>
                    Jetton wallet: ${jettonWallet.jetton}
                `;
                
            } catch (error) {
                resultDiv.innerHTML = `❌ Error: ${error.message}`;
            }
        }
        
        // Запускаем тест при загрузке
        testJettonBalance();
    </script>
</body>
</html>